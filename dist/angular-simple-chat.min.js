/*
 * angular-simple-chat 1.0.1
 * @description AngularJS chat directive
 * @link https://github.com/vogloblinsky/angular-simple-chat#readme
 * @license MIT
 */
!function(){"use strict";function e(e,t,n,s,a){return function(o,r,i){function l(){var e;if(h)e=h;else if(s.serverTime){var n=(new Date).getTime(),a=n-U+s.serverTime;e=t(a)}else e=t();return e}function c(){p&&(e.clearTimeout(p),p=null)}function m(t){var n=l().diff(t,"day"),s=w&&n>=w;if(s?r.text(t.format(C)):r.text(t.from(l(),v)),b&&!r.attr("title")&&r.attr("title",t.local().format(b)),!s){var a=Math.abs(l().diff(t,"minute")),o=3600;1>a?o=1:60>a?o=30:180>a&&(o=300),p=e.setTimeout(function(){m(t)},1e3*o)}}function u(e){x&&r.attr("datetime",e)}function d(){if(c(),g){var e=n.preprocessDate(g,T,f);m(e),u(e.toISOString())}}var g,h,p=null,f=a.format,v=s.withoutSuffix,b=s.titleFormat,w=s.fullDateThreshold,C=s.fullDateFormat,U=(new Date).getTime(),T=a.preprocess,$=i.amTimeAgo,x="TIME"===r[0].nodeName.toUpperCase();o.$watch($,function(e){return"undefined"==typeof e||null===e||""===e?(c(),void(g&&(r.text(""),u(""),g=null))):(g=e,void d())}),angular.isDefined(i.amFrom)&&o.$watch(i.amFrom,function(e){h="undefined"==typeof e||null===e||""===e?null:t(e),d()}),angular.isDefined(i.amWithoutSuffix)&&o.$watch(i.amWithoutSuffix,function(e){"boolean"==typeof e?(v=e,d()):v=s.withoutSuffix}),i.$observe("amFormat",function(e){"undefined"!=typeof e&&(f=e,d())}),i.$observe("amPreprocess",function(e){T=e,d()}),i.$observe("amFullDateThreshold",function(e){w=e,d()}),i.$observe("amFullDateFormat",function(e){C=e,d()}),o.$on("$destroy",function(){c()}),o.$on("amMoment:localeChanged",function(){d()})}}function t(){var e={bindToController:!0,controller:n,controllerAs:"cb",restrict:"AE",templateUrl:"directives/chat-bubble/chat-bubble.html",scope:{message:"=",localUser:"=",toUser:"="}};return e}function n(e){this.options=e.options()}function s(){var e={bindToController:!0,controller:a,controllerAs:"mc",restrict:"AE",templateUrl:"directives/message-composer/message-composer.html",scope:{localUser:"=",sendFunction:"=",sendButtonText:"=",composerPlaceholderText:"="}};return e}function a(e){this._send=function(){var t={id:"sc"+Date.now(),text:this.rawmessage,userId:this.localUser.userId,date:Date.now()};this.sendFunction(t),e.$emit("simple-chat-message-posted"),this.rawmessage=""}}function o(){var e={showUserAvatar:!0,showComposer:!0};this.options=function(){return e},this.setShowUserAvatar=function(t){e.showUserAvatar=t},this.setShowComposer=function(t){e.showComposer=t}}function r(e){function t(t,n,s,a){var o=angular.element(n.children()[0])[0],r=function(){o.scrollTop=o.scrollHeight};t.$on("simple-chat-message-posted",function(){e(r,0)}),angular.isDefined(a.messages)&&a.messages.length>0&&e(r,0),angular.isUndefined(a.messages)&&(a.messages=[])}var n={bindToController:!0,controller:"simpleChatController",controllerAs:"sc",link:t,restrict:"AE",templateUrl:"directives/simple-chat/simple-chat.html",scope:{messages:"=",localUser:"=",toUser:"=",sendFunction:"=",showUserAvatar:"=",showComposer:"=",sendButtonText:"@",composerPlaceholderText:"@"}};return n}function i(e){this.options=e.options(),angular.isDefined(this.showUserAvatar)&&e.setShowUserAvatar(this.showUserAvatar),angular.isDefined(this.showComposer)&&e.setShowComposer(this.showComposer)}e.$inject=["$window","moment","amMoment","amTimeAgoConfig","angularMomentConfig"],n.$inject=["SimpleChatConfiguration"],a.$inject=["$scope"],r.$inject=["$timeout"],i.$inject=["SimpleChatConfiguration"],angular.module("angular-simple-chat",["angular-simple-chat.directives"]),angular.module("angular-simple-chat.directives",[]),angular.module("angular-simple-chat.directives").constant("moment",moment).constant("angularMomentConfig",{preprocess:null,timezone:"",format:null,statefulFilters:!0}).constant("amTimeAgoConfig",{withoutSuffix:!1,serverTime:null,titleFormat:null,fullDateThreshold:null,fullDateFormat:null}).service("amMoment",["moment","$rootScope","$log","angularMomentConfig",function(e,t,n,s){this.preprocessors={utc:e.utc,unix:e.unix},this.changeLocale=function(n,s){var a=e.locale(n,s);return angular.isDefined(n)&&t.$broadcast("amMoment:localeChanged"),a},this.changeTimezone=function(e){s.timezone=e,t.$broadcast("amMoment:timezoneChanged")},this.preprocessDate=function(t,a,o){return angular.isUndefined(a)&&(a=s.preprocess),this.preprocessors[a]?this.preprocessors[a](t,o):(a&&n.warn("angular-moment: Ignoring unsupported value for preprocess: "+a),!isNaN(parseFloat(t))&&isFinite(t)?e(parseInt(t,10)):e(t,o))},this.applyTimezone=function(e,t){return(t=t||s.timezone)?(t.match(/^Z|[+-]\d\d:?\d\d$/i)?e=e.utcOffset(t):e.tz?e=e.tz(t):n.warn("angular-moment: named timezone specified but moment.tz() is undefined. Did you forget to include moment-timezone.js?"),e):e}}]).directive("amTimeAgo",e),angular.module("angular-simple-chat.directives").directive("chatBubble",t),angular.module("angular-simple-chat.directives").directive("messageComposer",s),angular.module("angular-simple-chat.directives").service("SimpleChatConfiguration",o),o.$inject=[],angular.module("angular-simple-chat.directives").directive("simpleChat",r),angular.module("angular-simple-chat.directives").controller("simpleChatController",i),angular.module("angular-simple-chat.directives").run(["$templateCache",function(e){e.put("directives/chat-bubble/chat-bubble.html",'<div ng-if="cb.localUser.userId !== cb.message.userId">\n    <img class="profile-avatar left"\n        ng-src="{{cb.toUser.avatar}}"\n        ng-if="cb.options.showUserAvatar"/>\n    <div class="chat-bubble-container left"\n        ng-class="{\'reset-margin-left\': !cb.options.showUserAvatar}">\n        <div class="message-detail">\n            <b>{{cb.toUser.username}}, </b>\n            <span am-time-ago="cb.message.date"></span>\n        </div>\n        <div class="chat-bubble left">\n            <div class="message">{{cb.message.text}}</div>\n        </div>\n    </div>\n</div>\n<div ng-if="cb.localUser.userId === cb.message.userId">\n    <img class="profile-avatar right"\n        ng-src="{{cb.localUser.avatar}}"\n        ng-if="cb.options.showUserAvatar"/>\n    <div class="chat-bubble-container right"\n        ng-class="{\'reset-margin-right\': !cb.options.showUserAvatar}">\n        <div class="message-detail">\n            <b>{{cb.localUser.username}}, </b>\n            <span am-time-ago="cb.message.date"></span>\n        </div>\n        <div class="chat-bubble right">\n            <div class="message">{{cb.message.text}}</div>\n        </div>\n    </div>\n</div>\n'),e.put("directives/simple-chat/simple-chat.html",'<div class="simple-chat-container"\n    ng-class="{\'full-height\': !sc.options.showComposer}">\n    <div ng-repeat="message in sc.messages track by message.id" class="message-wrapper">\n        <chat-bubble\n            message="message"\n            local-user="sc.localUser"\n            to-user="sc.toUser"\n            class="chat-bubble-main-container"\n        ></chat-bubble>\n    </div>\n</div>\n<message-composer\n    local-user="sc.localUser"\n    send-function="sc.sendFunction"\n    send-button-text="sc.sendButtonText"\n    composer-placeholder-text="sc.composerPlaceholderText"\n    ng-if="sc.options.showComposer"\n></message-composer>\n'),e.put("directives/message-composer/message-composer.html",'<form name="composeForm">\n    <textarea placeholder="{{mc.composerPlaceholderText || \'Write your message here.\'}}"\n            ng-model="mc.rawmessage"\n            name="message"\n            ng-required="true"></textarea>\n    <button ng-click="mc._send()"\n        ng-disabled="composeForm.$invalid">{{mc.sendButtonText || \'Send\'}}</button>\n</form>\n')}])}();